<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GLMMadaptive Basics â€¢ GLMMadaptive</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="GLMMadaptive Basics">
<meta property="og:description" content="GLMMadaptive">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">GLMMadaptive</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.8-0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/GLMMadaptive.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Custom_Models.html">Custom Models</a>
    </li>
    <li>
      <a href="../articles/Dynamic_Predictions.html">Dynamic Predictions</a>
    </li>
    <li>
      <a href="../articles/Goodness_of_Fit.html">Goodness of Fit for MixMod Objects</a>
    </li>
    <li>
      <a href="../articles/Methods.html">Methods for MixMod Objects</a>
    </li>
    <li>
      <a href="../articles/Multiple_Comparisons.html">Multiple Comparisons for MixMod Objects</a>
    </li>
    <li>
      <a href="../articles/Optimization.html">Optimization and Numerical Integration</a>
    </li>
    <li>
      <a href="../articles/Ordinal_Mixed_Models.html">Mixed Models for Ordinal Data</a>
    </li>
    <li>
      <a href="../articles/ZeroInflated_and_TwoPart_Models.html">Zero-Inflated and Two-Part Mixed Effects Models</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/drizopoulos/GLMMadaptive/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="GLMMadaptive_files/header-attrs-2.6/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>GLMMadaptive Basics</h1>
                        <h4 class="author">Dimitris Rizopoulos</h4>
            
            <h4 class="date">2021-01-27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/drizopoulos/GLMMadaptive/blob/master/vignettes/GLMMadaptive.Rmd"><code>vignettes/GLMMadaptive.Rmd</code></a></small>
      <div class="hidden name"><code>GLMMadaptive.Rmd</code></div>

    </div>

    
    
<div id="generalized-linear-mixed-models---theory" class="section level1">
<h1 class="hasAnchor">
<a href="#generalized-linear-mixed-models---theory" class="anchor"></a>Generalized Linear Mixed Models - Theory</h1>
<div id="model-specification" class="section level2">
<h2 class="hasAnchor">
<a href="#model-specification" class="anchor"></a>Model Specification</h2>
<p>Package <strong>GLMMadaptive</strong> provides a suit of functions for fitting and post-processing mixed effects models for grouped/clustered outcomes which have a distribution other than a normal distribution. In particular, let <span class="math inline">\(y_i\)</span> denote a vector of grouped/clustered outcome for the <span class="math inline">\(i\)</span>-th sample unit (<span class="math inline">\(i = 1, \ldots, n\)</span>). The conditional distribution of <span class="math inline">\(y_i\)</span> given a vector of random effects <span class="math inline">\(b_i\)</span> is assumed to be a member of the extended exponential family, with linear predictor given by <span class="math display">\[g\{E(y_i \mid b_i)\} = X_i \beta + Z_i b_i,\]</span> where <span class="math inline">\(g(\cdot)\)</span> denotes a monotonic link function, <span class="math inline">\(X_i\)</span> a design matrix for the fixed effects coefficients <span class="math inline">\(\beta\)</span>, and <span class="math inline">\(Z_i\)</span> a design matrix for the random effects coefficients <span class="math inline">\(b_i\)</span>. Typically, matrix <span class="math inline">\(Z_i\)</span> is assumed to be a subset of <span class="math inline">\(X_i\)</span>. The random effects are assumed to follow a normal distribution with mean 0 and variance-covariance matrix <span class="math inline">\(D\)</span>. In addition, the distribution <span class="math inline">\([y_i \mid b_i]\)</span> may potentially have extra dispersion/shape parameters <span class="math inline">\(\phi\)</span>.</p>
</div>
<div id="estimation" class="section level2">
<h2 class="hasAnchor">
<a href="#estimation" class="anchor"></a>Estimation</h2>
<p>The package focuses in settings in which the distribution <span class="math inline">\([y_i \mid b_i]\)</span> is not normal and/or the link function <span class="math inline">\(g(\cdot)\)</span> is not the identity. In these settings, the estimation of the model is complicated by the fact that the marginal log-likelihood function of the observed <span class="math inline">\(y_i\)</span> cannot be derived analytically. In particular, the log-likelihood function has the form: <span class="math display">\[\begin{eqnarray*}
\ell(\theta) &amp; = &amp; \sum_{i = 1}^n \log p(y_i; \theta)\\
&amp; = &amp; \sum_{i = 1}^n \log \int p(y_i \mid b_i; \theta) \, p(b_i; \theta) \, db_i,
\end{eqnarray*}\]</span> where <span class="math inline">\(\theta\)</span> denotes the full parameter vector including the fixed effects, the extra potential dispersion/shape parameters <span class="math inline">\(\phi\)</span> and the unique element of the covariance matrix <span class="math inline">\(D\)</span>, and <span class="math inline">\(p(\cdot)\)</span> denotes a probability density or probability mass function. The integral in the definition of <span class="math inline">\(\ell(\theta)\)</span> does not have a closed-form solution, and numerical approximations are required to obtain the maximum likelihood estimates.</p>
<p>In the literature several approaches have been proposed to approximate such integrals, and a nice overview is given in <a href="https://doi.org/10.1198/106186006X96962">Pinheiro and Chao (2006)</a>. A typical approach to approximate these integrals is the Laplace approximation. However, the general consensus has been that in the standard but difficult cases of binary/dichotomous data and count data with small counts and few repeated measurements, the accuracy of this approximation is rather low. Due to this fact, the general consensus is that the gold standard numerical approximation method is the adaptive Gaussian quadrature rule (<em>note: we focus here on maximum likelihood estimation; under the Bayesian paradigm, approaches, such as, MCMC and Hamiltonian Monte Carlo also provide accurate evaluation of the integrals</em>). This is more computationally intensive but also more accurate. This package provides an efficient implementation of the adaptive Gaussian quadrature rule, allowing for multiple correlated random effects (e.g., random intercepts, linear and quadratic random slopes) but currently a single grouping factor (i.e., no nested or crossed random effects designs).</p>
<p>A hybrid optimization procedure is implemented starting with an EM algorithm, treating the random effects as â€˜missing dataâ€™, followed by a direct optimization procedure with a quasi-Newton algorithm. Fine control of this procedure is allowed with a series of control arguments.</p>
</div>
</div>
<div id="generalized-linear-mixed-models---practice" class="section level1">
<h1 class="hasAnchor">
<a href="#generalized-linear-mixed-models---practice" class="anchor"></a>Generalized Linear Mixed Models - Practice</h1>
<div id="mixed-effects-logistic-regression" class="section level2">
<h2 class="hasAnchor">
<a href="#mixed-effects-logistic-regression" class="anchor"></a>Mixed Effects Logistic Regression</h2>
<p>We illustrate the use of the package in the standard case of a mixed effects logistic regression. That is, the distribution of <span class="math inline">\([y_i \mid b_i]\)</span> is binomial, and the distribution of <span class="math inline">\([b_i]\)</span> multivariate normal.</p>
<p>We start by simulating some data for a binary longitudinal outcome:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span>
<span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="co"># number of subjects</span>
<span class="va">K</span> <span class="op">&lt;-</span> <span class="fl">8</span> <span class="co"># number of measurements per subject</span>
<span class="va">t_max</span> <span class="op">&lt;-</span> <span class="fl">15</span> <span class="co"># maximum follow-up time</span>

<span class="co"># we construct a data frame with the design: </span>
<span class="co"># everyone has a baseline measurement, and then measurements at random follow-up times</span>
<span class="va">DF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">K</span><span class="op">)</span>,
                 time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span><span class="op">(</span><span class="va">n</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">K</span> <span class="op">-</span> <span class="fl">1</span>, <span class="fl">0</span>, <span class="va">t_max</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
                 sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/gl.html">gl</a></span><span class="op">(</span><span class="fl">2</span>, <span class="va">n</span><span class="op">/</span><span class="fl">2</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"male"</span>, <span class="st">"female"</span><span class="op">)</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">K</span><span class="op">)</span><span class="op">)</span>

<span class="co"># design matrices for the fixed and random effects</span>
<span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MixMod%20Methods.html">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="va">sex</span> <span class="op">*</span> <span class="va">time</span>, data <span class="op">=</span> <span class="va">DF</span><span class="op">)</span>
<span class="va">Z</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MixMod%20Methods.html">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="va">time</span>, data <span class="op">=</span> <span class="va">DF</span><span class="op">)</span>

<span class="va">betas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2.13</span>, <span class="op">-</span><span class="fl">0.25</span>, <span class="fl">0.24</span>, <span class="op">-</span><span class="fl">0.05</span><span class="op">)</span> <span class="co"># fixed effects coefficients</span>
<span class="va">D11</span> <span class="op">&lt;-</span> <span class="fl">0.48</span> <span class="co"># variance of random intercepts</span>
<span class="va">D22</span> <span class="op">&lt;-</span> <span class="fl">0.1</span> <span class="co"># variance of random slopes</span>

<span class="co"># we simulate random effects</span>
<span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">D11</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">D22</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co"># linear predictor</span>
<span class="va">eta_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/drop.html">drop</a></span><span class="op">(</span><span class="va">X</span> <span class="op">%*%</span> <span class="va">betas</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">Z</span> <span class="op">*</span> <span class="va">b</span><span class="op">[</span><span class="va">DF</span><span class="op">$</span><span class="va">id</span>, <span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="co"># we simulate binary longitudinal data</span>
<span class="va">DF</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="va">K</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">eta_y</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We fit a mixed effects logistic regression for <code>y</code>, assuming random intercepts for the random-effects part. The basic model-fitting function in <strong>GLMMadaptive</strong> is called <code><a href="../reference/mixed_model.html">mixed_model()</a></code>, and has four required arguments, namely <code>fixed</code> a formula for the fixed effects, <code>random</code> a formula for the random effects, <code>family</code> a family object specifying the type of response variable, and <code>data</code> a data frame containing the variables in the previously mentioned formulas. Hence, the call to fit the random intercepts logistic regression is:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mixed_model.html">mixed_model</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">*</span> <span class="va">time</span>, random <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">id</span>, data <span class="op">=</span> <span class="va">DF</span>,
                   family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The summary method gives a detailed output of the model:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fm1</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; mixed_model(fixed = y ~ sex * time, random = ~1 | id, data = DF, </span>
<span class="co">#&gt;     family = binomial())</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Data Descriptives:</span>
<span class="co">#&gt; Number of Observations: 800</span>
<span class="co">#&gt; Number of Groups: 100 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model:</span>
<span class="co">#&gt;  family: binomial</span>
<span class="co">#&gt;  link: logit </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Fit statistics:</span>
<span class="co">#&gt;    log.Lik      AIC      BIC</span>
<span class="co">#&gt;  -374.5197 759.0394 772.0653</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Random effects covariance matrix:</span>
<span class="co">#&gt;               StdDev</span>
<span class="co">#&gt; (Intercept) 2.064622</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Fixed effects:</span>
<span class="co">#&gt;                Estimate Std.Err z-value  p-value</span>
<span class="co">#&gt; (Intercept)     -2.6182  0.4448 -5.8862  &lt; 1e-04</span>
<span class="co">#&gt; sexfemale       -1.3242  0.6436 -2.0575 0.039639</span>
<span class="co">#&gt; time             0.2851  0.0396  7.2089  &lt; 1e-04</span>
<span class="co">#&gt; sexfemale:time   0.0402  0.0545  0.7372 0.461005</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Integration:</span>
<span class="co">#&gt; method: adaptive Gauss-Hermite quadrature rule</span>
<span class="co">#&gt; quadrature points: 11</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Optimization:</span>
<span class="co">#&gt; method: hybrid EM and quasi-Newton</span>
<span class="co">#&gt; converged: TRUE</span></code></pre></div>
<p>We continue by checking the impact of the chosen number of quadrature points to the parameters estimates and the log-likelihood value at convergence. First, we refit the model with an increasing number of quadrature points. The default when the number of random effects is smaller or equal to two is 11 points. We fit then with 15, and 21 points:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fm1_q11</span> <span class="op">&lt;-</span> <span class="va">fm1</span>
<span class="va">fm1_q15</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">fm1_q11</span>, nAGQ <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>
<span class="va">fm1_q21</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">fm1_q11</span>, nAGQ <span class="op">=</span> <span class="fl">21</span><span class="op">)</span>

<span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"nAGQ=11"</span> <span class="op">=</span> <span class="va">fm1_q11</span>, <span class="st">"nAGQ=15"</span> <span class="op">=</span> <span class="va">fm1_q15</span>, <span class="st">"nAGQ=21"</span> <span class="op">=</span> <span class="va">fm1_q21</span><span class="op">)</span></code></pre></div>
<p>We now extract from the model the estimated parameter for the fixed effects (using function <code><a href="../reference/MixMod%20Methods.html">fixef()</a></code>), for the random effects, and the log-likelihood (using function <code><a href="https://rdrr.io/r/stats/logLik.html">logLik()</a></code>):</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">extract</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">obj</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="../reference/MixMod%20Methods.html">fixef</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span>, <span class="st">"var_(Intercept)"</span> <span class="op">=</span> <span class="va">obj</span><span class="op">$</span><span class="va">D</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span>, <span class="st">"logLik"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">models</span>, <span class="va">extract</span><span class="op">)</span>
<span class="co">#&gt;                       nAGQ=11       nAGQ=15      nAGQ=21</span>
<span class="co">#&gt; (Intercept)       -2.61816557   -2.61679077   -2.6168440</span>
<span class="co">#&gt; sexfemale         -1.32418678   -1.32349829   -1.3235049</span>
<span class="co">#&gt; time               0.28514773    0.28501148    0.2850151</span>
<span class="co">#&gt; sexfemale:time     0.04015372    0.04020003    0.0401995</span>
<span class="co">#&gt; var_(Intercept)    4.26266211    4.26351799    4.2636311</span>
<span class="co">#&gt; logLik          -374.51972108 -374.51983340 -374.5198046</span></code></pre></div>
<p>We observe a rather stable model with virtually no differences between the different choices of quadrature points.</p>
<p>We first compare the model with a simple logistic regression that does not include any random effects:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">km</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">*</span> <span class="va">time</span>, data <span class="op">=</span> <span class="va">DF</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="../reference/MixMod%20Methods.html">anova</a></span><span class="op">(</span><span class="va">fm1</span>, <span class="va">km</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;        AIC    BIC log.Lik    LRT df p.value</span>
<span class="co">#&gt; fm1 759.04 772.07 -374.52                  </span>
<span class="co">#&gt; km  919.11 937.85 -455.55 162.07  1 &lt;0.0001</span></code></pre></div>
<p>We obtain a highly significant p-value suggesting that there are correlations in the data that cannot be ignored. <em>Note:</em> the <code><a href="../reference/MixMod%20Methods.html">anova()</a></code> method that performs the likelihood ratio test calculates the p-value using the standard <span class="math inline">\(\chi^2\)</span> distribution, here with one degree of freedom. However, because the null hypothesis for testing variance parameters is on the boundary of the corresponding parameter space, it would be more appropriate to use a mixture of <span class="math inline">\(\chi^2\)</span> distributions.</p>
<p>We extend model <code>fm1</code> by also including a random slopes term; however, we assume that the covariance between the random intercepts and random slopes is zero. This is achieved by using the <code><a href="https://rdrr.io/r/base/Logic.html">||</a></code> symbol in the specification of the <code>random</code> argument, i.e.,</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fm2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mixed_model.html">mixed_model</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">*</span> <span class="va">time</span>, random <span class="op">=</span> <span class="op">~</span> <span class="va">time</span> <span class="op">||</span> <span class="va">id</span>, data <span class="op">=</span> <span class="va">DF</span>,
                   family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The likelihood ratio test between the two models is computed with function <code><a href="../reference/MixMod%20Methods.html">anova()</a></code>. When two <code>"MixMod"</code> objects are provided, the function assumes that the first object represents the model under the null hypothesis, and the second object the model under the alternative, i.e.,</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/MixMod%20Methods.html">anova</a></span><span class="op">(</span><span class="va">fm1</span>, <span class="va">fm2</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;        AIC    BIC log.Lik  LRT df p.value</span>
<span class="co">#&gt; fm1 759.04 772.07 -374.52                </span>
<span class="co">#&gt; fm2 730.94 746.57 -359.47 30.1  1 &lt;0.0001</span></code></pre></div>
<p>The results suggest that we need the random slopes term. We continue by testing whether the covariance between the random effects terms is zero. The model under the alternative hypothesis is (results not shown):</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fm3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mixed_model.html">mixed_model</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">*</span> <span class="va">time</span>, random <span class="op">=</span> <span class="op">~</span> <span class="va">time</span> <span class="op">|</span> <span class="va">id</span>, data <span class="op">=</span> <span class="va">DF</span>,
                   family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>And again the likelihood ratio test is performed by a call to <code><a href="../reference/MixMod%20Methods.html">anova()</a></code> (results not shown):</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/MixMod%20Methods.html">anova</a></span><span class="op">(</span><span class="va">fm2</span>, <span class="va">fm3</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;        AIC    BIC log.Lik  LRT df p.value</span>
<span class="co">#&gt; fm2 730.94 746.57 -359.47                </span>
<span class="co">#&gt; fm3 731.63 749.86 -358.81 1.32  1  0.2514</span></code></pre></div>
<p>The results now suggest that indeed the covariance between the two random effects terms is not statistically different from zero.</p>
</div>
<div id="penalized-mixed-effects-poisson-regression" class="section level2">
<h2 class="hasAnchor">
<a href="#penalized-mixed-effects-poisson-regression" class="anchor"></a>Penalized Mixed Effects Poisson Regression</h2>
<p>We continue our illustration with a Poisson mixed effects model. We start again by simulating some data for a Poisson longitudinal outcome:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span>
<span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="co"># number of subjects</span>
<span class="va">K</span> <span class="op">&lt;-</span> <span class="fl">8</span> <span class="co"># number of measurements per subject</span>
<span class="va">t_max</span> <span class="op">&lt;-</span> <span class="fl">15</span> <span class="co"># maximum follow-up time</span>

<span class="co"># we construct a data frame with the design: </span>
<span class="co"># everyone has a baseline measurement, and then measurements at random follow-up times</span>
<span class="va">DF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">K</span><span class="op">)</span>,
                 time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span><span class="op">(</span><span class="va">n</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">K</span> <span class="op">-</span> <span class="fl">1</span>, <span class="fl">0</span>, <span class="va">t_max</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
                 sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/gl.html">gl</a></span><span class="op">(</span><span class="fl">2</span>, <span class="va">n</span><span class="op">/</span><span class="fl">2</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"male"</span>, <span class="st">"female"</span><span class="op">)</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">K</span><span class="op">)</span><span class="op">)</span>

<span class="co"># design matrices for the fixed and random effects</span>
<span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MixMod%20Methods.html">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="va">sex</span> <span class="op">*</span> <span class="va">time</span>, data <span class="op">=</span> <span class="va">DF</span><span class="op">)</span>

<span class="va">betas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2.13</span>, <span class="op">-</span><span class="fl">0.25</span>, <span class="fl">0.24</span>, <span class="op">-</span><span class="fl">0.05</span><span class="op">)</span> <span class="co"># fixed effects coefficients</span>
<span class="va">D11</span> <span class="op">&lt;-</span> <span class="fl">0.48</span> <span class="co"># variance of random intercepts</span>

<span class="co"># we simulate random effects</span>
<span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">D11</span><span class="op">)</span><span class="op">)</span>
<span class="co"># linear predictor</span>
<span class="va">eta_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/drop.html">drop</a></span><span class="op">(</span><span class="va">X</span> <span class="op">%*%</span> <span class="va">betas</span> <span class="op">+</span> <span class="va">b</span><span class="op">[</span><span class="va">DF</span><span class="op">$</span><span class="va">id</span><span class="op">]</span><span class="op">)</span>
<span class="co"># we simulate Poisson longitudinal data</span>
<span class="va">DF</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="va">K</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">eta_y</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We fit the mixed effects Poisson regression for <code>y</code> assuming random intercepts for the random-effects part.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mixed_model.html">mixed_model</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">*</span> <span class="va">time</span>, random <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">id</span>, data <span class="op">=</span> <span class="va">DF</span>,
                   family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>As previously, the summary method gives a detailed output of the model:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">gm1</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; mixed_model(fixed = y ~ sex * time, random = ~1 | id, data = DF, </span>
<span class="co">#&gt;     family = poisson())</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Data Descriptives:</span>
<span class="co">#&gt; Number of Observations: 800</span>
<span class="co">#&gt; Number of Groups: 100 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model:</span>
<span class="co">#&gt;  family: poisson</span>
<span class="co">#&gt;  link: log </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Fit statistics:</span>
<span class="co">#&gt;    log.Lik      AIC      BIC</span>
<span class="co">#&gt;  -2782.306 5574.611 5587.637</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Random effects covariance matrix:</span>
<span class="co">#&gt;                StdDev</span>
<span class="co">#&gt; (Intercept) 0.9781393</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Fixed effects:</span>
<span class="co">#&gt;                Estimate Std.Err  z-value   p-value</span>
<span class="co">#&gt; (Intercept)      2.9447  0.3082   9.5545   &lt; 1e-04</span>
<span class="co">#&gt; sexfemale       -0.8611  0.2699  -3.1906 0.0014199</span>
<span class="co">#&gt; time             0.2404  0.0016 151.3464   &lt; 1e-04</span>
<span class="co">#&gt; sexfemale:time  -0.0511  0.0028 -18.3982   &lt; 1e-04</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Integration:</span>
<span class="co">#&gt; method: adaptive Gauss-Hermite quadrature rule</span>
<span class="co">#&gt; quadrature points: 11</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Optimization:</span>
<span class="co">#&gt; method: hybrid EM and quasi-Newton</span>
<span class="co">#&gt; converged: TRUE</span></code></pre></div>
<p>In settings with few subjects, repeated measurements of separation effects, the package also allows to place a penalty in the fixed effects regression coefficients <span class="math inline">\(\beta\)</span>. The penalty/prior is in the form of a Studentâ€™s t distribution with mean 0, scale parameter 1, and 3 degrees of freedom, and it is placed in all <span class="math inline">\(\beta\)</span> coefficients except from the intercept. The penalized model can be fitted by setting argument <code>penalized</code> to <code>TRUE</code>, i.e.,</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gm2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mixed_model.html">mixed_model</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">*</span> <span class="va">time</span>, random <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">id</span>, data <span class="op">=</span> <span class="va">DF</span>,
                   family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span><span class="op">)</span>, penalized <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="st">'unpenalized'</span> <span class="op">=</span> <span class="fu"><a href="../reference/MixMod%20Methods.html">fixef</a></span><span class="op">(</span><span class="va">gm1</span><span class="op">)</span>, <span class="st">'penalized'</span> <span class="op">=</span> <span class="fu"><a href="../reference/MixMod%20Methods.html">fixef</a></span><span class="op">(</span><span class="va">gm2</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;                unpenalized  penalized</span>
<span class="co">#&gt; (Intercept)     2.94471508  2.9433924</span>
<span class="co">#&gt; sexfemale      -0.86111225 -0.8599373</span>
<span class="co">#&gt; time            0.24039444  0.2404593</span>
<span class="co">#&gt; sexfemale:time -0.05105926 -0.0511505</span></code></pre></div>
<p>In this example we observe small differences between the penalized and unpenalized models. The users have the option to alter the specification of the Studentâ€™s t penalty by directly specifying the mean, scale and degrees of freedom arguments of the distribution. For example, a ridge penalty could be placed by setting the degrees of freedom to a high value. The call in this case should be:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gm3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mixed_model.html">mixed_model</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">*</span> <span class="va">time</span>, random <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">id</span>, data <span class="op">=</span> <span class="va">DF</span>,
                   family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span><span class="op">)</span>, 
                   penalized <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>pen_mu <span class="op">=</span> <span class="fl">0</span>, pen_sigma <span class="op">=</span> <span class="fl">1</span>, pen_df <span class="op">=</span> <span class="fl">200</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://www.drizopoulos.com/">Dimitris Rizopoulos</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
