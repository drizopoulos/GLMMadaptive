<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Goodness of Fit for MixMod Objects â€¢ GLMMadaptive</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Goodness of Fit for MixMod Objects">
<meta property="og:description" content="GLMMadaptive">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">GLMMadaptive</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.9-0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/GLMMadaptive.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Custom_Models.html">Custom Models</a>
    </li>
    <li>
      <a href="../articles/Dynamic_Predictions.html">Dynamic Predictions</a>
    </li>
    <li>
      <a href="../articles/Goodness_of_Fit.html">Goodness of Fit for MixMod Objects</a>
    </li>
    <li>
      <a href="../articles/Methods.html">Methods for MixMod Objects</a>
    </li>
    <li>
      <a href="../articles/Multiple_Comparisons.html">Multiple Comparisons for MixMod Objects</a>
    </li>
    <li>
      <a href="../articles/Optimization.html">Optimization and Numerical Integration</a>
    </li>
    <li>
      <a href="../articles/Ordinal_Mixed_Models.html">Mixed Models for Ordinal Data</a>
    </li>
    <li>
      <a href="../articles/ZeroInflated_and_TwoPart_Models.html">Zero-Inflated and Two-Part Mixed Effects Models</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/drizopoulos/GLMMadaptive/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Goodness of Fit for MixMod Objects</h1>
                        <h4 data-toc-skip class="author">Dimitris
Rizopoulos</h4>
            
            <h4 data-toc-skip class="date">2023-06-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/drizopoulos/GLMMadaptive/blob/HEAD/vignettes/Goodness_of_Fit.Rmd" class="external-link"><code>vignettes/Goodness_of_Fit.Rmd</code></a></small>
      <div class="hidden name"><code>Goodness_of_Fit.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="goodness-of-fit-using-simulated-residuals">Goodness of Fit using Simulated Residuals<a class="anchor" aria-label="anchor" href="#goodness-of-fit-using-simulated-residuals"></a>
</h2>
<p>In this vignette we illustrate how to evaluate the goodness-of-fit of
mixed models fitted by the <code><a href="../reference/mixed_model.html">mixed_model()</a></code> function using the
procedures described in the <a href="https://cran.r-project.org/package=DHARMa" class="external-link"><strong>DHARMa</strong></a>
package.</p>
<div class="section level3">
<h3 id="zero-inflated-negative-binomial-longitudinal-data">Zero-Inflated Negative Binomial Longitudinal Data<a class="anchor" aria-label="anchor" href="#zero-inflated-negative-binomial-longitudinal-data"></a>
</h3>
<p>We start by simulating a longitudinal outcome from a zero-inflated
negative binomial distribution:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">300</span> <span class="co"># number of subjects</span></span>
<span><span class="va">K</span> <span class="op">&lt;-</span> <span class="fl">8</span> <span class="co"># number of measurements per subject</span></span>
<span><span class="va">t_max</span> <span class="op">&lt;-</span> <span class="fl">5</span> <span class="co"># maximum follow-up time</span></span>
<span></span>
<span><span class="co"># we construct a data frame with the design: </span></span>
<span><span class="co"># everyone has a baseline measurement, and then measurements at random follow-up times</span></span>
<span><span class="va">DF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">K</span><span class="op">)</span>,</span>
<span>                 time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="va">n</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">K</span> <span class="op">-</span> <span class="fl">1</span>, <span class="fl">0</span>, <span class="va">t_max</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                 sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/gl.html" class="external-link">gl</a></span><span class="op">(</span><span class="fl">2</span>, <span class="va">n</span><span class="op">/</span><span class="fl">2</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"male"</span>, <span class="st">"female"</span><span class="op">)</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">K</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># design matrices for the fixed and random effects non-zero part</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/methods.html">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="va">sex</span> <span class="op">*</span> <span class="va">time</span>, data <span class="op">=</span> <span class="va">DF</span><span class="op">)</span></span>
<span><span class="va">Z</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/methods.html">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">DF</span><span class="op">)</span></span>
<span><span class="co"># design matrices for the fixed and random effects zero part</span></span>
<span><span class="va">X_zi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/methods.html">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="va">sex</span>, data <span class="op">=</span> <span class="va">DF</span><span class="op">)</span></span>
<span><span class="va">Z_zi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/methods.html">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">DF</span><span class="op">)</span></span>
<span></span>
<span><span class="va">betas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="op">-</span><span class="fl">0.03</span><span class="op">)</span> <span class="co"># fixed effects coefficients non-zero part</span></span>
<span><span class="va">shape</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># shape/size parameter of the negative binomial distribution</span></span>
<span><span class="va">gammas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.5</span>, <span class="fl">0.5</span><span class="op">)</span> <span class="co"># fixed effects coefficients zero part</span></span>
<span><span class="va">D11</span> <span class="op">&lt;-</span> <span class="fl">0.5</span> <span class="co"># variance of random intercepts non-zero part</span></span>
<span><span class="va">D22</span> <span class="op">&lt;-</span> <span class="fl">0.4</span> <span class="co"># variance of random intercepts zero part</span></span>
<span></span>
<span><span class="co"># we simulate random effects</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">D11</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">D22</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># linear predictor non-zero part</span></span>
<span><span class="va">eta_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">betas</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">Z</span> <span class="op">*</span> <span class="va">b</span><span class="op">[</span><span class="va">DF</span><span class="op">$</span><span class="va">id</span>, <span class="fl">1</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># linear predictor zero part</span></span>
<span><span class="va">eta_zi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">X_zi</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">gammas</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">Z_zi</span> <span class="op">*</span> <span class="va">b</span><span class="op">[</span><span class="va">DF</span><span class="op">$</span><span class="va">id</span>, <span class="fl">2</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># we simulate negative binomial longitudinal data</span></span>
<span><span class="va">DF</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/NegBinomial.html" class="external-link">rnbinom</a></span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="va">K</span>, size <span class="op">=</span> <span class="va">shape</span>, mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta_y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># we set the extra zeros</span></span>
<span><span class="va">DF</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">as.logical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="va">K</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">eta_zi</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="function-for-scaled-simulated-residuals">Function for Scaled Simulated Residuals<a class="anchor" aria-label="anchor" href="#function-for-scaled-simulated-residuals"></a>
</h3>
<p>Because <strong>DHARMa</strong> does not yet support objects of class
<code>MixMod</code> (see <a href="https://github.com/florianhartig/DHARMa/issues/96" class="external-link">here</a> for
current plants), we provide a wrapper function to enable the use of the
procedures of the package:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resids_plot</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">object</span>, <span class="va">y</span>, <span class="va">nsim</span> <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                         <span class="va">type</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"subject_specific"</span>, <span class="st">"mean_subject"</span><span class="op">)</span>,</span>
<span>                         <span class="va">integerResponse</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">object</span>, <span class="st">"MixMod"</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"this function works for 'MixMod' objects.\n"</span><span class="op">)</span></span>
<span>    <span class="va">type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.arg.html" class="external-link">match.arg</a></span><span class="op">(</span><span class="va">type</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">integerResponse</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">integer_families</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"binomial"</span>, <span class="st">"poisson"</span>, <span class="st">"negative binomial"</span>,</span>
<span>                              <span class="st">"zero-inflated poisson"</span>, <span class="st">"zero-inflated negative binomial"</span>, </span>
<span>                              <span class="st">"hurdle poisson"</span>, <span class="st">"hurdle negative binomial"</span><span class="op">)</span></span>
<span>        <span class="va">numeric_families</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hurdle log-normal"</span>, <span class="st">"beta"</span>, <span class="st">"hurdle beta"</span>, <span class="st">"Gamma"</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">object</span><span class="op">$</span><span class="va">family</span><span class="op">$</span><span class="va">family</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">integer_families</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">integerResponse</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span>        <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">object</span><span class="op">$</span><span class="va">family</span><span class="op">$</span><span class="va">family</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">numeric_families</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">integerResponse</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>            <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"non build-in family object; you need to specify the 'integerResponse',\n"</span>,</span>
<span>                 <span class="st">"\targument indicating whether the outcome variable is integer or not.\n"</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/methods.html">simulate</a></span><span class="op">(</span><span class="va">object</span>, nsim <span class="op">=</span> <span class="va">nsim</span>, type <span class="op">=</span> <span class="va">type</span><span class="op">)</span></span>
<span>    <span class="va">fits</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/methods.html">fitted</a></span><span class="op">(</span><span class="va">object</span>, type <span class="op">=</span> <span class="va">type</span><span class="op">)</span></span>
<span>    <span class="va">dharmaRes</span> <span class="op">&lt;-</span> <span class="fu">DHARMa</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/createDHARMa.html" class="external-link">createDHARMa</a></span><span class="op">(</span>simulatedResponse <span class="op">=</span> <span class="va">sims</span>, observedResponse <span class="op">=</span> <span class="va">y</span>, </span>
<span>                              fittedPredictedResponse <span class="op">=</span> <span class="va">fits</span>, </span>
<span>                              integerResponse <span class="op">=</span> <span class="va">integerResponse</span><span class="op">)</span></span>
<span>    <span class="fu">DHARMa</span><span class="fu">:::</span><span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/plot.DHARMa.html" class="external-link">plot.DHARMa</a></span><span class="op">(</span><span class="va">dharmaRes</span>, quantreg <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This function has the following arguments:</p>
<ul>
<li>
<code>object</code>: an object inheriting from class
<code>MixMod</code>.</li>
<li>
<code>y</code>: the observed response vector.</li>
<li>
<code>nsim</code>: an integer indicating the number of simulated
datasets; defaults is 1000.</li>
<li>
<code>type</code>: what type of fitted values and data to simulate,
i.e., including the random effects or setting them to zero.</li>
<li>
<code>integerResponse</code>: logical; set to <code>TRUE</code> for
discrete grouped/cluster outcome data. Based on the chosen family when
fitting the model, the function attempts to determine itself what
<code>integerResponse</code> should be. But for user-specified family
objects, the user needs to define this argument himself/herself.</li>
</ul>
</div>
<div class="section level3">
<h3 id="poisson-mixed-model">Poisson Mixed Model<a class="anchor" aria-label="anchor" href="#poisson-mixed-model"></a>
</h3>
<p>We start by fitting a Poisson mixed model to the data using the
following call to <code><a href="../reference/mixed_model.html">mixed_model()</a></code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mixed_model.html">mixed_model</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">*</span> <span class="va">time</span>, random <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">id</span>, data <span class="op">=</span> <span class="va">DF</span>,</span>
<span>                   family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We expect that this model will not fit the data well because it does
not account for the over-dispersion and the extra zeros we have
simulated. To evaluate the fit we compare the simulated outcome data
from the model versus the observed outcome data. If the model fits the
data well, we would expect the observed outcome data to have the same
empirical distribution as the empirical distribution of the simulated
data. The following call to <code>resids_plot()</code> performs this
comparison:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">resids_plot</span><span class="op">(</span><span class="va">fm1</span>, <span class="va">DF</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; DHARMa:testOutliers with type = binomial may have inflated Type I error rates for integer-valued distributions. To get a more exact result, it is recommended to re-run testOutliers with type = 'bootstrap'. See ?testOutliers for details</span></span></code></pre></div>
<p><img src="Goodness_of_Fit_files/figure-html/poisson_mixed_model_GoF-1.png" width="816" style="display: block; margin: auto;"></p>
<p>The left panel shows the QQ-plot of the observed versus expected
residuals. According to the manner the scaled residuals are calculated
in <strong>DHARMa</strong>, we expect these residuals to have a uniform
distribution in the interval <span class="math inline">\((0, 1)\)</span>
for a well-specified model. The <span class="math inline">\(p\)</span>-value reported in the plot is the one
obtained from the Kolmogorov-Smirnov test for testing uniformity. The
right panel shows the scatterplot of the residuals against the fitted
values. To provide a visual aid in detecting deviations from uniformity
in the y-direction, the plot of the residuals against the predicted
values also performs a quantile regression, which provides 0.25, 0.5 and
0.75 quantile lines across the plots. These lines should be straight,
horizontal, and at y-values of 0.25, 0.5 and 0.75. Note, however, that
some deviations from this are to be expected by chance, even for a
perfect model, especially if the sample size is small.</p>
<p>It is evident from these two plots that the Poisson model does not
fit the data satisfactorily.</p>
</div>
<div class="section level3">
<h3 id="zero-inflated-poisson-mixed-model">Zero-Inflated Poisson Mixed Model<a class="anchor" aria-label="anchor" href="#zero-inflated-poisson-mixed-model"></a>
</h3>
<p>To improve the simple Poisson model, allow for extra zeros using the
zero-inflated Poisson mixed model. First, here we only include fixed
effects in the linear predictor of the logistic regression for the extra
zeros:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fm2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mixed_model.html">mixed_model</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">*</span> <span class="va">time</span>, random <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">id</span>, data <span class="op">=</span> <span class="va">DF</span>,</span>
<span>                   family <span class="op">=</span> <span class="fu"><a href="../reference/extra_fams.html">zi.poisson</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                   zi_fixed <span class="op">=</span> <span class="op">~</span> <span class="va">sex</span><span class="op">)</span></span></code></pre></div>
<p>Using <code>resids_plot()</code> again we evaluate the fit this
model:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">resids_plot</span><span class="op">(</span><span class="va">fm2</span>, <span class="va">DF</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; DHARMa:testOutliers with type = binomial may have inflated Type I error rates for integer-valued distributions. To get a more exact result, it is recommended to re-run testOutliers with type = 'bootstrap'. See ?testOutliers for details</span></span></code></pre></div>
<p><img src="Goodness_of_Fit_files/figure-html/zi_poisson_mixed_model_GoF-1.png" width="816" style="display: block; margin: auto;"></p>
<p>We observe that the fit has improved, but still we have evident
deviations from uniformity.</p>
</div>
<div class="section level3">
<h3 id="zero-inflated-poisson-mixed-model-extra-random-effects">Zero-Inflated Poisson Mixed Model Extra Random Effects<a class="anchor" aria-label="anchor" href="#zero-inflated-poisson-mixed-model-extra-random-effects"></a>
</h3>
<p>We further extend the zero-inflated Poisson mixed model by also
allowing for a random intercept in the linear predictor of the logistic
regression for the extra zeros:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fm3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mixed_model.html">mixed_model</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">*</span> <span class="va">time</span>, random <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">id</span>, data <span class="op">=</span> <span class="va">DF</span>,</span>
<span>                   family <span class="op">=</span> <span class="fu"><a href="../reference/extra_fams.html">zi.poisson</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                   zi_fixed <span class="op">=</span> <span class="op">~</span> <span class="va">sex</span>, zi_random <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">id</span><span class="op">)</span></span></code></pre></div>
<p>We check the fit with the simulated residuals:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">resids_plot</span><span class="op">(</span><span class="va">fm3</span>, <span class="va">DF</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; DHARMa:testOutliers with type = binomial may have inflated Type I error rates for integer-valued distributions. To get a more exact result, it is recommended to re-run testOutliers with type = 'bootstrap'. See ?testOutliers for details</span></span></code></pre></div>
<p><img src="Goodness_of_Fit_files/figure-html/zi_poisson_mixed_model2_GoF-1.png" width="816" style="display: block; margin: auto;"></p>
<p>There are still deviations from uniformity, indicating that the fit
of the last model to the data is not optimal.</p>
</div>
<div class="section level3">
<h3 id="zero-inflated-negative-binomial-mixed-model-extra-random-effects">Zero-Inflated Negative Binomial Mixed Model Extra Random
Effects<a class="anchor" aria-label="anchor" href="#zero-inflated-negative-binomial-mixed-model-extra-random-effects"></a>
</h3>
<p>As a final attempt, we allow of over-dispersion by changing the
Poisson distribution to the negative binomial distribution. The rest of
the components remain the same:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fm4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mixed_model.html">mixed_model</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">*</span> <span class="va">time</span>, random <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">id</span>, data <span class="op">=</span> <span class="va">DF</span>,</span>
<span>                   family <span class="op">=</span> <span class="fu"><a href="../reference/extra_fams.html">zi.negative.binomial</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                   zi_fixed <span class="op">=</span> <span class="op">~</span> <span class="va">sex</span>, zi_random <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">id</span><span class="op">)</span></span></code></pre></div>
<p>We check the fit with the simulated residuals:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">resids_plot</span><span class="op">(</span><span class="va">fm4</span>, <span class="va">DF</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span></code></pre></div>
<p><img src="Goodness_of_Fit_files/figure-html/zi_NB_mixed_model_GoF-1.png" width="816" style="display: block; margin: auto;"></p>
<p>We now observe that the fit of the zero-inflated model seems to be
acceptable. The right panel still shows that the lines from the quantile
regression are not horizontal, but as previously explained, these may
potentially show deviations even for the correct model.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="http://www.drizopoulos.com/" class="external-link">Dimitris Rizopoulos</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
