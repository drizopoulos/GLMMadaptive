<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mixed Models for Ordinal Data â€¢ GLMMadaptive</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Mixed Models for Ordinal Data">
<meta property="og:description" content="GLMMadaptive">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">GLMMadaptive</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.7-0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Custom_Models.html">Custom Models</a>
    </li>
    <li>
      <a href="../articles/Dynamic_Predictions.html">Dynamic Predictions</a>
    </li>
    <li>
      <a href="../articles/GLMMadaptive_basics.html">GLMMadaptive Basics</a>
    </li>
    <li>
      <a href="../articles/Goodness_of_Fit.html">Goodness of Fit for MixMod Objects</a>
    </li>
    <li>
      <a href="../articles/Methods_MixMod.html">Methods for MixMod Objects</a>
    </li>
    <li>
      <a href="../articles/Multiple_Comparisons.html">Multiple Comparisons for MixMod Objects</a>
    </li>
    <li>
      <a href="../articles/Optimization.html">Optimization and Numerical Integration in GLMMadaptive</a>
    </li>
    <li>
      <a href="../articles/Ordinal_Mixed_Models.html">Mixed Models for Ordinal Data</a>
    </li>
    <li>
      <a href="../articles/ZeroInflated_and_TwoPart_Models.html">Zero-Inflated and Two-Part Mixed Effects Models</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/drizopoulos/GLMMadaptive/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Ordinal_Mixed_Models_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Mixed Models for Ordinal Data</h1>
                        <h4 class="author">Dimitris Rizopoulos</h4>
            
            <h4 class="date">2020-06-25</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/drizopoulos/GLMMadaptive/blob/master/vignettes/Ordinal_Mixed_Models.Rmd"><code>vignettes/Ordinal_Mixed_Models.Rmd</code></a></small>
      <div class="hidden name"><code>Ordinal_Mixed_Models.Rmd</code></div>

    </div>

    
    
<div id="continuation-ratio-model" class="section level2">
<h2 class="hasAnchor">
<a href="#continuation-ratio-model" class="anchor"></a>Continuation Ratio Model</h2>
<div id="definition" class="section level3">
<h3 class="hasAnchor">
<a href="#definition" class="anchor"></a>Definition</h3>
<p>In many applications the outcome of interest is an ordinal variable, i.e., a categorical variable with a natural ordering of its levels. For example, an ordinal response may represent levels of a standard measurement scale, such as pain severity (none, mild, moderate, severe) or economic status, with three categories (low, medium and high). A variety of statistical models, namely, proportional odds, adjacent category, stereotype logit, and continuation ratio can be used for an ordinal response. Here we focus on the continuation ratio model. Let <span class="math inline">\(y_i\)</span> denote a vector of grouped/clustered outcome for the <span class="math inline">\(i\)</span>-th sample unit (<span class="math inline">\(i = 1, \ldots, n\)</span>). We assume that each measurement in <span class="math inline">\(y_{ij}\)</span>, <span class="math inline">\((j = 1, \ldots, n_i)\)</span> can take values <span class="math inline">\(K + 1\)</span> possible values in the ordered set <span class="math inline">\(\{0, 1, \ldots, K\}\)</span>. The continuation ratio mixed effects model is based on conditional probabilities for this outcome <span class="math inline">\(y_i\)</span>. Namely, the <em>backward</em> formulation of the model postulates: <span class="math display">\[
\log \left \{ \frac{\Pr(y_{ij} = k \mid y_{ij} \leq k)}{1 - \Pr(y_{ij} = k \mid y_{ij} \leq k)} \right \} = \alpha_k + x_{ij}^\top \beta + z_{ij}^\top b_i,
\]</span> whereas the forward formulation is: <span class="math display">\[
\log \left \{ \frac{\Pr(y_{ij} = k \mid y_{ij} \geq k)}{1 - \Pr(y_{ij} = k \mid y_{ij} \geq k)} \right \} = \alpha_k + x_{ij}^\top \beta + z_{ij}^\top b_i,
\]</span> where $k {0, 1, , K} $, <span class="math inline">\(x_{ij}\)</span> denotes the <span class="math inline">\(j\)</span>-th row of the fixed effects design matrix <span class="math inline">\(X_i\)</span>, with the corresponding fixed effects coefficients denoted by <span class="math inline">\(\beta\)</span>, <span class="math inline">\(z_{ij}\)</span> denotes the <span class="math inline">\(j\)</span>-th row of the random effects design matrix <span class="math inline">\(Z_i\)</span> with corresponding random effects <span class="math inline">\(b_i\)</span>, which follow a normal distribution with mean zero and variance-covariance matrix <span class="math inline">\(D\)</span>. The coefficients <span class="math inline">\(\alpha_k\)</span> denote the threshold parameters for each category. The design matrix for the fixed effects <span class="math inline">\(X\)</span> does not contain an intercept term because the separate threshold coefficients <span class="math inline">\(\alpha_k\)</span> are estimated. The design matrix for the random effects <span class="math inline">\(Z\)</span> contains the intercept, implicitly assuming the same random intercept for all categories of the ordinal response variable. For identification reasons, <span class="math inline">\(K\)</span> threshold parameters are estimated.</p>
<p>The backward formulation is commonly used when progression through disease states from none, mild, moderate,severe is represented by increasing integer values, and interest lies in estimating the odds of more severe disease compared to less severe disease. The forward formulation specifies that subjects have to â€˜pass throughâ€™ one category to get to the next one. The forward formulation is a equivalent to a discrete version of Cox proportional hazards models.</p>
</div>
<div id="marginal-probabilities" class="section level3">
<h3 class="hasAnchor">
<a href="#marginal-probabilities" class="anchor"></a>Marginal Probabilities</h3>
<p>In the backward formulation the marginal probabilities for each category are given by <span class="math display">\[
\Pr(y_{ij} = k) = 
\left \{
\begin{array}{ll}
\frac{\exp(\alpha_k + x_{ij}^\top \beta + z_{ij}^\top b_i)}{1 + \exp(\alpha_k + x_{ij}^\top \beta + z_{ij}^\top b_i)} &amp; k = K,\\\\
\frac{\exp(\alpha_k + x_{ij}^\top \beta + z_{ij}^\top b_i)}{1 + \exp(\alpha_k + x_{ij}^\top \beta + z_{ij}^\top b_i)} \times 
\prod_{k' &gt; k} \frac{1}{1 + \exp(\alpha_{k'} + x_{ij}^\top \beta + z_{ij}^\top b_i)}&amp; k &lt; K,
\end{array}
\right.
\]</span> whereas in the forward formulation they get the form: <span class="math display">\[
\Pr(y_{ij} = k) = 
\left \{
\begin{array}{ll}
\frac{\exp(\alpha_k + x_{ij}^\top \beta + z_{ij}^\top b_i)}{1 + \exp(\alpha_k + x_{ij}^\top \beta + z_{ij}^\top b_i)} &amp; k = 0,\\\\
\frac{\exp(\alpha_k + x_{ij}^\top \beta + z_{ij}^\top b_i)}{1 + \exp(\alpha_k + x_{ij}^\top \beta + z_{ij}^\top b_i)} \times 
\prod_{k' &lt; k} \frac{1}{1 + \exp(\alpha_{k'} + x_{ij}^\top \beta + z_{ij}^\top b_i)}&amp; k &gt; 0,
\end{array}
\right.
\]</span></p>
<p><strong>Note:</strong> These are marginal probabilities over the categories of the ordinal response; as the above formulation shows, these are still conditional on the random effects.</p>
</div>
<div id="estimation" class="section level3">
<h3 class="hasAnchor">
<a href="#estimation" class="anchor"></a>Estimation</h3>
<p>An advantage of the continuation ratio model is that its likelihood can be easily re-expressed such that it can be fitted with software the fits (mixed effects) logistic regression. The details behind this re-expression of the likelihood are given, for example, in <a href="https://doi.org/10.1093/oxfordjournals.aje.a115109">Armstrong and Sloan (1989)</a>, and <a href="https://doi.org/10.1002/sim.4780101108">Berridge and Whitehead (1991)</a>. This formulation requires a couple of data management steps creating separate records for each measurement, and suitably replicating the corresponding rows of the design matrices <span class="math inline">\(X_i\)</span> and <span class="math inline">\(Z_i\)</span>. In addition, a new â€˜cohortâ€™ variable is constructed denoting at which category the specific measurement of <span class="math inline">\(i\)</span>-th subject belongs. An extra advantage of this formulation is that we can easily evaluate if specific covariates satisfy the ordinality assumption (i.e., that their coefficients are independent of the category <span class="math inline">\(k\)</span>) by including into the model their interaction with the â€˜cohortâ€™ variable and testing its significance.</p>
</div>
</div>
<div id="an-example" class="section level2">
<h2 class="hasAnchor">
<a href="#an-example" class="anchor"></a>An Example</h2>
<div id="simulated-data" class="section level3">
<h3 class="hasAnchor">
<a href="#simulated-data" class="anchor"></a>Simulated Data</h3>
<p>In this section we will illustrate how the continuation ratio model can be fitted with the <code><a href="../reference/mixed_model.html">mixed_model()</a></code> function of the <strong>GLMMadaptive</strong> package. We start by simulating some data for an ordinal longitudinal outcome under the forward formulation of the continuation ratio model:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">1234</span>)
<span class="no">n</span> <span class="kw">&lt;-</span> <span class="fl">300</span> <span class="co"># number of subjects</span>
<span class="no">K</span> <span class="kw">&lt;-</span> <span class="fl">8</span> <span class="co"># number of measurements per subject</span>
<span class="no">t_max</span> <span class="kw">&lt;-</span> <span class="fl">15</span> <span class="co"># maximum follow-up time</span>

<span class="co"># we constuct a data frame with the design: </span>
<span class="co"># everyone has a baseline measurment, and then measurements at random follow-up times</span>
<span class="no">DF</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span>(<span class="no">n</span>), <span class="kw">each</span> <span class="kw">=</span> <span class="no">K</span>),
                 <span class="kw">time</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span>(<span class="no">n</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="no">K</span> - <span class="fl">1</span>, <span class="fl">0</span>, <span class="no">t_max</span>))))),
                 <span class="kw">sex</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/gl.html">gl</a></span>(<span class="fl">2</span>, <span class="no">n</span>/<span class="fl">2</span>, <span class="kw">labels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"male"</span>, <span class="st">"female"</span>)), <span class="kw">each</span> <span class="kw">=</span> <span class="no">K</span>))

<span class="co"># design matrices for the fixed and random effects</span>
<span class="co"># we exclude the intercept from the design matrix of the fixed effects because in the</span>
<span class="co"># CR model we have K intercepts (the alpha_k coefficients in the formulation above)</span>
<span class="no">X</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/methods.html">model.matrix</a></span>(~ <span class="no">sex</span> * <span class="no">time</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">DF</span>)[, -<span class="fl">1</span>]
<span class="no">Z</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/methods.html">model.matrix</a></span>(~ <span class="no">time</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">DF</span>)

<span class="no">thrs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">1.5</span>, <span class="fl">0</span>, <span class="fl">0.9</span>) <span class="co"># thresholds for the different ordinal categories</span>
<span class="no">betas</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">0.25</span>, <span class="fl">0.24</span>, -<span class="fl">0.05</span>) <span class="co"># fixed effects coefficients</span>
<span class="no">D11</span> <span class="kw">&lt;-</span> <span class="fl">0.48</span> <span class="co"># variance of random intercepts</span>
<span class="no">D22</span> <span class="kw">&lt;-</span> <span class="fl">0.1</span> <span class="co"># variance of random slopes</span>

<span class="co"># we simulate random effects</span>
<span class="no">b</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n</span>, <span class="kw">sd</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">D11</span>)), <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n</span>, <span class="kw">sd</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">D22</span>)))
<span class="co"># linear predictor</span>
<span class="no">eta_y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/drop.html">drop</a></span>(<span class="no">X</span> <span class="kw">%*%</span> <span class="no">betas</span> + <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(<span class="no">Z</span> * <span class="no">b</span>[<span class="no">DF</span>$<span class="no">id</span>, , <span class="kw">drop</span> <span class="kw">=</span> <span class="fl">FALSE</span>]))
<span class="co"># linear predictor for each category under forward CR formulation</span>
<span class="co"># for the backward formulation, check the note below</span>
<span class="no">eta_y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/outer.html">outer</a></span>(<span class="no">eta_y</span>, <span class="no">thrs</span>, <span class="st">"+"</span>)
<span class="co"># marginal probabilities per category</span>
<span class="no">mprobs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/continuation_ratio.html">cr_marg_probs</a></span>(<span class="no">eta_y</span>)
<span class="co"># we simulate ordinal longitudinal data</span>
<span class="no">DF</span>$<span class="no">y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unname.html">unname</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">mprobs</span>, <span class="fl">1</span>, <span class="no">sample</span>, <span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(<span class="no">mprobs</span>), <span class="kw">size</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">replace</span> <span class="kw">=</span> <span class="fl">TRUE</span>))
<span class="no">DF</span>$<span class="no">y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">DF</span>$<span class="no">y</span>, <span class="kw">levels</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">4</span>, <span class="kw">labels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"none"</span>, <span class="st">"mild"</span>, <span class="st">"moderate"</span>, <span class="st">"severe"</span>))</pre></body></html></div>
<p><strong>Note:</strong> If we wanted to simulate from the backward formulation of continuation ratio model, we need to reverse the ordering of the thresholds, namely the line <code>eta_y &lt;- outer(eta_y, thrs, "+")</code> of the code above should be replaced by <code>eta_y &lt;- outer(eta_y, rev(thrs), "+")</code>, and also specify in the call to <code><a href="../reference/continuation_ratio.html">cr_marg_probs()</a></code> that <code>direction = "backward"</code>.</p>
</div>
<div id="data-preparation-forward-formulation" class="section level3">
<h3 class="hasAnchor">
<a href="#data-preparation-forward-formulation" class="anchor"></a>Data Preparation Forward Formulation</h3>
<p>As explained in the Estimation Section above, before proceeding in fitting the model we need to reconstruct the database by creating extra records for each longitudinal measurement, a new dichotomous outcome and a â€˜cohortâ€™ variable denoting the record at which the original measurement corresponded. These variables are created with the <code><a href="../reference/continuation_ratio.html">cr_setup()</a></code> function. The underlying code in this function is based on the code of the <code>cr.setup()</code> function of the <a href="https://cran.r-project.org/package=rms"><strong>rms</strong></a> package, but allowing for both the forward and backward formulation of the continuation ratio model. The specific steps are:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">cr_vals</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/continuation_ratio.html">cr_setup</a></span>(<span class="no">DF</span>$<span class="no">y</span>)
<span class="no">cr_data</span> <span class="kw">&lt;-</span> <span class="no">DF</span>[<span class="no">cr_vals</span>$<span class="no">subs</span>, ]
<span class="no">cr_data</span>$<span class="no">y_new</span> <span class="kw">&lt;-</span> <span class="no">cr_vals</span>$<span class="no">y</span>
<span class="no">cr_data</span>$<span class="no">cohort</span> <span class="kw">&lt;-</span> <span class="no">cr_vals</span>$<span class="no">cohort</span></pre></body></html></div>
<p>By default <code><a href="../reference/continuation_ratio.html">cr_setup()</a></code> works under the forward formulation (i.e., the one we have simulated from). To fit the continuation ratio model under the backward formulation, we would need to set <code>direction = "backward"</code> in the call to <code><a href="../reference/continuation_ratio.html">cr_setup()</a></code>.</p>
<p>Hence, to fit the model we will use the outcome <code>y_new</code> in the new dataset <code>cr_data</code>.</p>
</div>
<div id="basic-continuation-ratio-model" class="section level3">
<h3 class="hasAnchor">
<a href="#basic-continuation-ratio-model" class="anchor"></a>Basic Continuation Ratio Model</h3>
<p>We begin with a random intercepts model, with fixed effects <code>sex</code> and <code>time</code>. Note that the <code>cohort</code> variable needs also to be included into the model:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">fm</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mixed_model.html">mixed_model</a></span>(<span class="no">y_new</span> ~ <span class="no">cohort</span> + <span class="no">sex</span> + <span class="no">time</span>, <span class="kw">random</span> <span class="kw">=</span> ~ <span class="fl">1</span> <span class="kw">|</span> <span class="no">id</span>,
                  <span class="kw">data</span> <span class="kw">=</span> <span class="no">cr_data</span>, <span class="kw">family</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span>())

<span class="no">fm</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; mixed_model(fixed = y_new ~ cohort + sex + time, random = ~1 | </span>
<span class="co">#&gt;     id, data = cr_data, family = binomial())</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model:</span>
<span class="co">#&gt;  family: binomial</span>
<span class="co">#&gt;  link: logit </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Random effects covariance matrix:</span>
<span class="co">#&gt;               StdDev</span>
<span class="co">#&gt; (Intercept) 1.346031</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Fixed effects:</span>
<span class="co">#&gt;       (Intercept)     cohorty&gt;=mild cohorty&gt;=moderate         sexfemale </span>
<span class="co">#&gt;        -0.9269543         1.0520746         1.5450799        -0.4591298 </span>
<span class="co">#&gt;              time </span>
<span class="co">#&gt;         0.1143118 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; log-Lik: -2712.608</span></pre></body></html></div>
<p>According to the definition of the model, the coefficients have a log odds ratio interpretation for a unit increase of the corresponding covariate. For example, <code>exp(fixef(fm)['sexfemale']) =</code> 0.63 is the odds ratio for females versus males for <span class="math inline">\(y = k\)</span>, whatever the conditioning event <span class="math inline">\(y \geq k\)</span>.</p>
</div>
<div id="relaxing-the-cr-assumption" class="section level3">
<h3 class="hasAnchor">
<a href="#relaxing-the-cr-assumption" class="anchor"></a>Relaxing the CR Assumption</h3>
<p>As an illustration, we show how we can relax the ordinality assumption for the <code>sex</code> variable, namely, allowing that the effect of <code>sex</code> is different for each of the response categories of our ordinal outcome <span class="math inline">\(y\)</span>. As explained earlier, this can be achieved by simply including the interaction term between the <code>sex</code> and <code>cohort</code> variables, i.e.:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">gm</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mixed_model.html">mixed_model</a></span>(<span class="no">y_new</span> ~ <span class="no">cohort</span> * <span class="no">sex</span> + <span class="no">time</span>, <span class="kw">random</span> <span class="kw">=</span> ~ <span class="fl">1</span> <span class="kw">|</span> <span class="no">id</span>,
                  <span class="kw">data</span> <span class="kw">=</span> <span class="no">cr_data</span>, <span class="kw">family</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span>())

<span class="no">gm</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; mixed_model(fixed = y_new ~ cohort * sex + time, random = ~1 | </span>
<span class="co">#&gt;     id, data = cr_data, family = binomial())</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model:</span>
<span class="co">#&gt;  family: binomial</span>
<span class="co">#&gt;  link: logit </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Random effects covariance matrix:</span>
<span class="co">#&gt;             StdDev</span>
<span class="co">#&gt; (Intercept) 1.3446</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Fixed effects:</span>
<span class="co">#&gt;                 (Intercept)               cohorty&gt;=mild </span>
<span class="co">#&gt;                  -0.9247568                   1.0967165 </span>
<span class="co">#&gt;           cohorty&gt;=moderate                   sexfemale </span>
<span class="co">#&gt;                   1.4406591                  -0.4605628 </span>
<span class="co">#&gt;                        time     cohorty&gt;=mild:sexfemale </span>
<span class="co">#&gt;                   0.1140999                  -0.0843883 </span>
<span class="co">#&gt; cohorty&gt;=moderate:sexfemale </span>
<span class="co">#&gt;                   0.1790653 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; log-Lik: -2711.869</span></pre></body></html></div>
<p>To test whether this extension is required we can perform a likelihood ratio test using the <code><a href="../reference/methods.html">anova()</a></code> method:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="../reference/methods.html">anova</a></span>(<span class="no">fm</span>, <span class="no">gm</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt;        AIC     BIC  log.Lik  LRT df p.value</span>
<span class="co">#&gt; fm 5437.22 5459.44 -2712.61                </span>
<span class="co">#&gt; gm 5439.74 5469.37 -2711.87 1.48  2  0.4775</span></pre></body></html></div>
<p>As we expected the test suggests that <code>sex</code> satisfies the ordinality / continuation ratio assumption.</p>
</div>
<div id="effect-plots-of-conditional-probabilities" class="section level3">
<h3 class="hasAnchor">
<a href="#effect-plots-of-conditional-probabilities" class="anchor"></a>Effect Plots of Conditional Probabilities</h3>
<p>Finally, we produce effect plots based on our final model <code>fm</code>. The required data for these plots are calculated from the <code><a href="../reference/effectPlotData.html">effectPlotData()</a></code> function. Note that because we would like to obtain the predicted values and confidence intervals for all categories of our ordinal outcome, we also need to include the <code>cohort</code> variable in the specification of the data frame based on which <code><a href="../reference/effectPlotData.html">effectPlotData()</a></code> will calculate the predicted values. The following code calculates the data for the plot for both sexes and follow-up times in the interval from 0 to 10:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">nDF</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span>(<span class="no">cr_data</span>, <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span>(<span class="kw">cohort</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(<span class="no">cohort</span>), <span class="kw">sex</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(<span class="no">sex</span>),
                                 <span class="kw">time</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>, <span class="fl">10</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fl">55</span>)))

<span class="no">plot_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/effectPlotData.html">effectPlotData</a></span>(<span class="no">fm</span>, <span class="no">nDF</span>)</pre></body></html></div>
<p>Then we produce the plot with the following call to the <code>xyplot()</code> function from the <strong>lattice</strong> package:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">expit</span> <span class="kw">&lt;-</span> <span class="kw">function</span> (<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="no">x</span>) / (<span class="fl">1</span> + <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="no">x</span>))
<span class="no">my_panel_bands</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">y</span>, <span class="no">upper</span>, <span class="no">lower</span>, <span class="no">fill</span>, <span class="no">col</span>, <span class="no">subscripts</span>, <span class="no">...</span>, <span class="no">font</span>,
                           <span class="no">fontface</span>) {
    <span class="no">upper</span> <span class="kw">&lt;-</span> <span class="no">upper</span>[<span class="no">subscripts</span>]
    <span class="no">lower</span> <span class="kw">&lt;-</span> <span class="no">lower</span>[<span class="no">subscripts</span>]
    <span class="fu">panel.polygon</span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(<span class="no">x</span>)), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">upper</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(<span class="no">lower</span>)), <span class="kw">col</span> <span class="kw">=</span> <span class="no">fill</span>, <span class="kw">border</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="no">...</span>)
}

<span class="fu">xyplot</span>(<span class="fu">expit</span>(<span class="no">pred</span>) ~ <span class="no">time</span> <span class="kw">|</span> <span class="no">sex</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">cohort</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">plot_data</span>,
       <span class="kw">upper</span> <span class="kw">=</span> <span class="fu">expit</span>(<span class="no">plot_data</span>$<span class="no">upp</span>), <span class="kw">low</span> <span class="kw">=</span> <span class="fu">expit</span>(<span class="no">plot_data</span>$<span class="no">low</span>), <span class="kw">type</span> <span class="kw">=</span> <span class="st">"l"</span>,
       <span class="kw">panel</span> <span class="kw">=</span> <span class="kw">function</span> (<span class="no">x</span>, <span class="no">y</span>, <span class="no">...</span>) {
           <span class="fu">panel.superpose</span>(<span class="no">x</span>, <span class="no">y</span>, <span class="kw">panel.groups</span> <span class="kw">=</span> <span class="no">my_panel_bands</span>, <span class="no">...</span>)
           <span class="fu">panel.xyplot</span>(<span class="no">x</span>, <span class="no">y</span>, <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">2</span>,  <span class="no">...</span>)
       }, <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">"Follow-up time"</span>, <span class="kw">ylab</span> <span class="kw">=</span> <span class="st">"Continuation Ratio Probabilities"</span>)</pre></body></html></div>
<p><img src="Ordinal_Mixed_Models_files/figure-html/CR_probs_plot-1.png" width="816" style="display: block; margin: auto;"></p>
<p>The <code>my_panel_bands()</code> is used to put the different curves for the response categories in the same plot.</p>
</div>
<div id="effect-plots-of-marginal-probabilities" class="section level3">
<h3 class="hasAnchor">
<a href="#effect-plots-of-marginal-probabilities" class="anchor"></a>Effect Plots of Marginal Probabilities</h3>
<p>The effect plot of the previous section depicts the conditional probabilities according to the forward formulation of the continuation ratio model. However, it is easier to understand the marginal probabilities of each category, calculated according to the formulas presented in the first section and the <code><a href="../reference/continuation_ratio.html">cr_marg_probs()</a></code> function. The <code><a href="../reference/effectPlotData.html">effectPlotData()</a></code> can calculate these marginal probabilities by invoking its <code>CR_cohort_varname</code> argument in which the name of the cohort variable needs to be provided. The following call calculates the plot data for the marginal probabilities based on model <code>fm</code>:</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">plot_data_m</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/effectPlotData.html">effectPlotData</a></span>(<span class="no">fm</span>, <span class="no">nDF</span>, <span class="kw">CR_cohort_varname</span> <span class="kw">=</span> <span class="st">"cohort"</span>,
                              <span class="kw">direction</span> <span class="kw">=</span> <span class="st">"forward"</span>)</pre></body></html></div>
<p>The dataset produced by <code><a href="../reference/effectPlotData.html">effectPlotData()</a></code> contains a new variable named <code>ordinal_response</code> that specifies the different categories of the ordinal outcome. To plot these probabilities we use an analogous call to <code>xyplot()</code>:</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">key</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">space</span> <span class="kw">=</span> <span class="st">"top"</span>, <span class="kw">rep</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
            <span class="kw">text</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(<span class="no">DF</span>$<span class="no">y</span>)[<span class="fl">1</span>:<span class="fl">2</span>]),
            <span class="kw">lines</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">lty</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">1</span>), <span class="kw">lwd</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">2</span>), <span class="kw">col</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"#0080ff"</span>, <span class="st">"#ff00ff"</span>)),
            <span class="kw">text</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(<span class="no">DF</span>$<span class="no">y</span>)[<span class="fl">3</span>:<span class="fl">4</span>]),
            <span class="kw">lines</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">lty</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">1</span>), <span class="kw">lwd</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">2</span>), <span class="kw">col</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"darkgreen"</span>, <span class="st">"#ff0000"</span>)))

<span class="fu">xyplot</span>(<span class="fu">expit</span>(<span class="no">pred</span>) ~ <span class="no">time</span> <span class="kw">|</span> <span class="no">sex</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">ordinal_response</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">plot_data_m</span>,
       <span class="kw">upper</span> <span class="kw">=</span> <span class="fu">expit</span>(<span class="no">plot_data_m</span>$<span class="no">upp</span>), <span class="kw">low</span> <span class="kw">=</span> <span class="fu">expit</span>(<span class="no">plot_data_m</span>$<span class="no">low</span>), <span class="kw">type</span> <span class="kw">=</span> <span class="st">"l"</span>,
       <span class="kw">panel</span> <span class="kw">=</span> <span class="kw">function</span> (<span class="no">x</span>, <span class="no">y</span>, <span class="no">...</span>) {
           <span class="fu">panel.superpose</span>(<span class="no">x</span>, <span class="no">y</span>, <span class="kw">panel.groups</span> <span class="kw">=</span> <span class="no">my_panel_bands</span>, <span class="no">...</span>)
           <span class="fu">panel.xyplot</span>(<span class="no">x</span>, <span class="no">y</span>, <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="no">...</span>)
       }, <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">"Follow-up time"</span>, <span class="kw">ylab</span> <span class="kw">=</span> <span class="st">"Marginal Probabilities"</span>, <span class="kw">key</span> <span class="kw">=</span> <span class="no">key</span>)</pre></body></html></div>
<p><img src="Ordinal_Mixed_Models_files/figure-html/CR_probs_plot_marg-1.png" width="816" style="display: block; margin: auto;"></p>
<p>To marginalize over the random effects as well you will need to set the <code>marginal</code> argument of <code><a href="../reference/effectPlotData.html">effectPlotData()</a></code> to <code>TRUE</code>, e.g.,</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">plot_data_m2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/effectPlotData.html">effectPlotData</a></span>(<span class="no">fm</span>, <span class="no">nDF</span>, <span class="kw">CR_cohort_varname</span> <span class="kw">=</span> <span class="st">"cohort"</span>,
                               <span class="kw">direction</span> <span class="kw">=</span> <span class="st">"forward"</span>, <span class="kw">marginal</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">cores</span> <span class="kw">=</span> <span class="fl">2</span>)</pre></body></html></div>
<p>To plot these probabilities we use an analogous call to <code>xyplot()</code>:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu">xyplot</span>(<span class="fu">expit</span>(<span class="no">pred</span>) ~ <span class="no">time</span> <span class="kw">|</span> <span class="no">sex</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">ordinal_response</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">plot_data_m2</span>,
       <span class="kw">upper</span> <span class="kw">=</span> <span class="fu">expit</span>(<span class="no">plot_data_m2</span>$<span class="no">upp</span>), <span class="kw">low</span> <span class="kw">=</span> <span class="fu">expit</span>(<span class="no">plot_data_m2</span>$<span class="no">low</span>), <span class="kw">type</span> <span class="kw">=</span> <span class="st">"l"</span>,
       <span class="kw">panel</span> <span class="kw">=</span> <span class="kw">function</span> (<span class="no">x</span>, <span class="no">y</span>, <span class="no">...</span>) {
           <span class="fu">panel.superpose</span>(<span class="no">x</span>, <span class="no">y</span>, <span class="kw">panel.groups</span> <span class="kw">=</span> <span class="no">my_panel_bands</span>, <span class="no">...</span>)
           <span class="fu">panel.xyplot</span>(<span class="no">x</span>, <span class="no">y</span>, <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">2</span>,  <span class="no">...</span>)
       }, <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">"Follow-up time"</span>,
       <span class="kw">ylab</span> <span class="kw">=</span> <span class="st">"Marginal Probabilities\nalso w.r.t Random Effects"</span>,
       <span class="kw">key</span> <span class="kw">=</span> <span class="no">key</span>)</pre></body></html></div>
<p><img src="Ordinal_Mixed_Models_files/figure-html/CR_probs_plot_marg2-1.png" width="816" style="display: block; margin: auto;"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://www.drizopoulos.com/">Dimitris Rizopoulos</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
